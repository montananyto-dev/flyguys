<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge"> <!-- â€  -->
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <title>FlyGuys Search</title>
        <link rel="shortcut icon" type="image/png" href="../images/favicon.png"/>


        <link rel="stylesheet" type="text/css" href="../css/userindex.css">

        <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>

        <script>
            
            $.ajax({url: "http://localhost:8000/controller/SessionManager.php", success: function(result){
                var json = JSON.parse(result);

                document.cookie = `cookie_name=${json.cookie_name} cookie_value=${json.cookie_value} cookie_time=${json.cookie_time}`;
                console.log(document.cookie);
            }});
        </script>
    </head>
    <body>
        <nav>

        </nav>

        <aside>
            <ul id="basket">
                <p class="underline">My Basket</p>
                <li>Rome to Paris</li>
                <li>New York to Boston</li>
                <button>Checkout</button>
            </ul>
        </aside>

        <main>
            <h1>FlyGuys</h1>
            <section id="search">
                <h2>Search</h2>
                <form>
                    <div class="row">
                        <input id="from" list="fromlist" type="search" placeholder="To" class="unanswered">
                        <input id="to" list="tolist"  type="search" placeholder="From" class="unanswered">
                        <datalist id="fromlist">
                        </datalist>
                        <datalist id="tolist">
                        </datalist>
    
                    </div>
                    <div class="row">
                        <select>
                            <option>Day</option>
                            <option>Monday</option>
                            <option>Tuesday</option>
                            <option>Wednesday</option>
                            <option>Thursday</option>
                            <option>Friday</option>
                            <option>Saturday</option>
                            <option>Sunday</option>
                        </select>
                        <span class="seperator"> or </span>
                        <input type="date">
                        <input type="submit" value="Search">
                    </div>
                </form>
            </section>

            <section id="results">
                <h2>Results</h2>
                <section class="flight">
                    <p></p>
                    
                    
                </section>

            </section>
        </main>
    </body>

    <script>
        
        $.ajax({url: "http://localhost:8000/controller/locations/names.php", success: function(result){
            var fromLocations = JSON.parse(result);
            
            console.log(fromLocations);

            // For From Locations - Generate DataList and set valid inputs
            setDataList(document.querySelector("#fromlist"), fromLocations);
            setValidInputs(document.querySelector("#from"), fromLocations);

            $("#from").focusout(function() {
                var selectedFromLocation = document.getElementById("from").value;
                $.ajax({url: `http://localhost:8000/controller/locations/getConnectedLocations.php?name=${selectedFromLocation}`, success: function(result) {
                    console.log(result);
                    var toLocations = JSON.parse(result);
                    setDataList(document.querySelector("#tolist"), toLocations);
                    setValidInputs(document.querySelector("#to"), fromLocations);
                }});

            })
        }});

        function setDataList(dataListElem, locations) {
            for(var i=0; i< locations.length; i++) {
                var elem = document.createElement("option");
                elem.setAttribute("value", locations[i]);
                dataListElem.appendChild(elem);
            }
        }

        function setValidInputs(elem, arr) {
            elem.addEventListener("change", function() {
                if(arr.indexOf(elem.value) < 0) {
                    elem.removeAttribute("class");
                    elem.setAttribute("class", "wrong");
                } else {
                    elem.removeAttribute("class");
                    elem.setAttribute("class","right");
                }
            });  
        }
        
        

        $("input[type=submit").click(function() {
            alert("cool");
            return false;
        })



        //<option value="Glasgow">

    </script>
</html>