<html>

<head>

    <link rel="stylesheet" type="text/css" href="../css/view_flight.css">

    <title>Admin</title>

    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>

</head>

<body>


<div class="navbar">

    <div class="dropdown">

        <button class="dropbtn">View Destination

            <i class="fa fa-caret-down"></i>

        </button>

        <div class="dropdown-content">

            <a href="#" id="viewAllFlight" onclick="retrieveAllFlights('')">View all flights</a>
            <a href="#" id="viewDomesticFlight" onclick="retrieveAllFlights('?region=Domestic')">View domestic
                flights</a>
            <a href="#" id="viewEuropeanFlight" onclick="retrieveAllFlights('?region=Europe')">View european flights</a>

        </div>

    </div>

    <a href="#" onclick="generateForm()">Add Destination</a>
    <a href="#">Edit Destination</a>
    <a href="#">Delete Destination</a>

    <a class="logout" href="#">Logout</a>

</div>

<div id="main"></div>

</body>

<script>

    $(function () {
        retrieveAllFlights('');
    });

    function retrieveAllFlights(regionName) {
        $.ajax({

            url: 'http://localhost:8000/controller/getFlights.php' + regionName,
            success: function (result) {

                console.log(result);

                var allFlights = JSON.parse(result);
                var root = document.getElementById('main');
                clearTable(root);
                generateTable(allFlights, root);
                populateTable(allFlights, root);


            },
            error: function () {
            }
        })
    }

    function generateTable(data, root) {

        var table = document.createElement('table');
        table.setAttribute('id', 'flight-table');

        var tr = document.createElement('tr');
        var th0 = document.createElement('th');
        th0.innerHTML = "Flight ID";
        var th1 = document.createElement('th');
        th1.innerHTML = "Departure";
        var th2 = document.createElement('th');
        th2.innerHTML = "Arrival";
        var th = document.createElement('th');
        th.innerHTML = "Capacity";
        var th3 = document.createElement('th');
        th3.innerHTML = "Cost";
        var th4 = document.createElement('th');
        th4.innerHTML = "Duration";
        var th5 = document.createElement('th');
        th5.innerHTML = "Region";
        var th6 = document.createElement('th');
        var th7 = document.createElement('th');

        tr.appendChild(th0);
        tr.appendChild(th1);
        tr.appendChild(th2);
        tr.appendChild(th3);
        tr.appendChild(th4);
        tr.appendChild(th5);
        tr.appendChild(th6);
        tr.appendChild(th7);

        root.appendChild(table);
        table.appendChild(tr);

    }

    function clearTable(root) {

        while (root.firstChild) {
            root.removeChild(root.firstChild);
        }

    }

    function populateTable(data, root) {

        var td6 = "";

        for (var i = 0; i < data.length; i++) {

            var tr = document.createElement('tr');
            tr.setAttribute('id', 'tr' + data[i].id);

            var td0 = document.createElement('td');
            td0.innerHTML = data[i].id;
            var td1 = document.createElement('td');
            td1.innerHTML = data[i].connection.fromLocation.name;
            var td2 = document.createElement('td');
            td2.innerHTML = data[i].connection.toLocation.name;
            var td3 = document.createElement('td');
            td3.innerHTML = data[i].capacity;
            var td4 = document.createElement('td');
            td4.innerHTML = data[i].connection.cost;
            var td5 = document.createElement('td');
            td5.innerHTML = data[i].connection.flight_duration;
            var td6 = document.createElement('td');

            if (data[i].connection.toLocation.region.name == "Europe" || data[i].connection.fromLocation.region.name == "Europe") {
                td6.innerHTML = "Europe";
            } else {
                td6.innerHTML = "Domestic"
            }

            var editButton = document.createElement('button');
            editButton.innerHTML = 'edit';
            editButton.setAttribute('class', 'edit');
            editButton.setAttribute('id', 'edit' + 'Id' + i);
            editButton.setAttribute('onclick', 'editFlights(this.id);');

            var td7 = document.createElement('td');
            var td8 = document.createElement('td');

            var deleteButton = document.createElement('button');
            deleteButton.innerHTML = 'delete';
            deleteButton.setAttribute('class', 'delete');
            deleteButton.setAttribute('id', data[i].id);
            deleteButton.setAttribute('onclick', 'deleteFlight(this.id);');

            tr.appendChild(td0);
            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);
            tr.appendChild(td5);
            tr.appendChild(td6);
            tr.appendChild(td7);
            tr.appendChild(td8);
            tr.appendChild(editButton);
            tr.appendChild(deleteButton);
            root.appendChild(tr);

        }
    }

    function editFlights(id) {
        console.log(id);
    }

    function deleteFlight(id) {
        document.getElementById(id).parentElement.remove()
        deleteFlightFromDatabase(id);
    }

    function deleteFlightFromDatabase(flightNumber) {
        $.ajax({
            url: 'http://localhost:8000/controller/deleteFlights.php' + '?flight_id=' + flightNumber,
            success: function (result) {

                console.log(result);
            },
            error: function () {
            }
        })
    }

    function generateForm() {

        var root = document.getElementById('main');
        clearTable(root);

        var form = document.createElement('form');
        form.setAttribute('id', 'addDestination');

        var regionLabel = document.createElement('label');
        regionLabel.innerHTML = 'region';

        var selectRegion = document.createElement('select');
        selectRegion.setAttribute('id', 'select');

        var locationFromLabel = document.createElement('label');
        locationFromLabel.innerHTML = 'Departure';
        var locationFromLabelInput = document.createElement('input');
        locationFromLabelInput.setAttribute('name', 'locationFrom');

        var locationToLabel = document.createElement('label');
        locationToLabel.innerHTML = 'Arrival';
        var locationToInput = document.createElement('input');
        locationToInput.setAttribute('name', 'locationTo');

        var flightDuration = document.createElement('label');
        flightDuration.innerHTML = 'Flight Duration';
        var flightDurationInput = document.createElement('input');
        flightDurationInput.setAttribute('name', 'FlightDuration');

        var capacity = document.createElement('label');
        capacity.innerHTML = 'Capacity';
        var capacityInput = document.createElement('input');
        capacityInput.setAttribute('name', 'Capacity');

        var cost = document.createElement('label');
        cost.innerHTML = 'Cost';
        var costInput = document.createElement('input');
        costInput.setAttribute('name', 'Cost');

        var submitButton = document.createElement("button");
        submitButton.innerHTML = 'submit';
        submitButton.setAttribute('id', 'submit');

        $(function () {

            $('#addDestination').on('submit', function (e) {
                e.preventDefault();
                var formData = JSON.stringify($('#addDestination').serializeArray());
                $.ajax({

                    type: "POST",
                    url: 'http://localhost:8000/controller/addFlights.php',
                    data: formData,
                    dataType: "json",
                    contentType: "application/json",
                    success: function (result) {

                    }, error: function () {
                    },
                });
            });
        });

        form.appendChild(regionLabel);
        form.appendChild(selectRegion);
        getAllRegions(selectRegion);
        form.appendChild(locationFromLabel);
        form.appendChild(locationFromLabelInput);
        form.appendChild(locationToLabel);
        form.appendChild(locationToInput);
        form.appendChild(flightDuration);
        form.appendChild(flightDurationInput);
        form.appendChild(capacity);
        form.appendChild(capacityInput);
        form.appendChild(cost);
        form.appendChild(costInput);
        form.appendChild(submitButton);

        root.appendChild(form);


    };

    function getAllRegions(selectRegion) {

        $.ajax({
            url: 'http://localhost:8000/controller/addFlights.php',
            success: function (result) {
                var regionNames = JSON.parse(result);
                setOptionForSelectRegion(selectRegion, regionNames);
            }, error: function () {
            },

        });
    };

    function setOptionForSelectRegion(selectRegion, regionNames) {

        regionNames.forEach(function (data) {
            var element = document.createElement('option');
            element.innerHTML = data;
            console.log(data);
            selectRegion.appendChild(element);
        })
    }

    function

</script>

</html>

